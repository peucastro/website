---
import BaseLayout from "@layouts/BaseLayout.astro";
import Schema from "@components/common/Schema.astro";
import TagBadge from "@components/ui/TagBadge.svelte";
import { personSchema } from "$lib/config";

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  updatedDate?: Date;
  label: string;
  tags?: string[];
  category?: string;
  image?: string;
}

const {
  title,
  description,
  pubDate,
  updatedDate,
  label,
  tags = [],
  category = "",
  image = "/og-default.png",
} = Astro.props;

const articleSchema = {
  "@context": "https://schema.org" as const,
  "@type": "BlogPosting" as const,
  headline: title,
  description: description,
  url: Astro.url.href,
  datePublished: pubDate.toISOString(),
  dateModified: updatedDate ? updatedDate.toISOString() : pubDate.toISOString(),
  author: personSchema,
  publisher: personSchema,
  keywords: tags,
  articleSection: category,
  inLanguage: "en-US",
  mainEntityOfPage: {
    "@type": "WebPage" as const,
    "@id": Astro.url.href,
  },
};
---

<BaseLayout title={title} description={description} image={image}>
  <Schema type="article" data={articleSchema} />

  <article class="mx-auto max-w-3xl">
    <header class="mb-8 space-y-2">
      <div class="text-muted flex gap-2 font-mono text-xs uppercase">
        <span class="text-primary">{label}</span>
        <span class="select-none">/</span>
        <time datetime={pubDate.toISOString()}>{pubDate.toDateString()}</time>
      </div>

      <h1 class="text-fg-strong text-4xl leading-relaxed font-bold lowercase">
        {title}
      </h1>
      {
        tags && tags.length > 0 && (
          <div class="mt-2 flex flex-wrap gap-2">
            {tags.map((tag: string) => (
              <TagBadge {tag} />
            ))}
          </div>
        )
      }

      <slot name="meta" />
    </header>

    <section
      class="prose dark:prose-invert prose-headings:text-fg-strong prose-code:text-primary max-w-none"
    >
      <slot />
    </section>
  </article>
</BaseLayout>
