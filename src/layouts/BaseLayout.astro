---
import "@styles/global.css";
import BaseHead from "@components/common/BaseHead.astro";
import Schema from "@components/common/Schema.astro";
import Footer from "@components/common/Footer.svelte";
import Header from "@components/common/Header.svelte";
import { SITE_METADATA, personSchema } from "$lib/config";

interface Props {
  title?: string;
  description?: string;
  image?: string;
}

const {
  title,
  description = SITE_METADATA.description,
  image = "/og-default.png",
} = Astro.props;

const fullTitle = title
  ? `${title} | ${SITE_METADATA.author}`
  : SITE_METADATA.title;
const currentPath = Astro.url.pathname;

const websiteSchema = {
  "@context": "https://schema.org" as const,
  "@type": "WebSite" as const,
  name: SITE_METADATA.title,
  url: SITE_METADATA.siteUrl,
  description: SITE_METADATA.description,
  inLanguage: "en-US",
  author: personSchema,
};
---

<html lang="en" dir="ltr">
  <head>
    <BaseHead title={fullTitle} description={description} image={image} />
    <Schema type="website" data={websiteSchema} />

    <script is:inline>
      (function () {
        const getThemePreference = () => {
          const saved =
            typeof localStorage !== "undefined" &&
            localStorage.getItem("theme");
          if (saved) return saved;

          return window.matchMedia("(prefers-color-scheme: light)").matches
            ? "light"
            : "dark";
        };

        const theme = getThemePreference();
        const root = document.documentElement;

        root.classList.toggle("light", theme === "light");

        window
          .matchMedia("(prefers-color-scheme: light)")
          .addEventListener("change", (e) => {
            if (!localStorage.getItem("theme")) {
              root.classList.toggle("light", e.matches);
            }
          });
      })();
    </script>
  </head>
  <body>
    <Header {currentPath} />
    <main class="mx-auto mt-12 mb-12 min-h-screen max-w-5xl px-6">
      <slot />
    </main>
    <Footer client:visible />
  </body>
</html>
